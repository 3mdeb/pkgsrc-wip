# $NetBSD$
#
###########################################################
#                  Generated by fbsd2pkg                  #
#              Thu Sep 13 14:20:25 CDT 2018               #
###########################################################

###########################################################
# Unconverted and partially converted FreeBSD port syntax:

#LIBS+=		-L${PREFIX}/lib -lthr

DISTNAME=	salmon-${PV}
DIST_SUBDIR=	salmon
CATEGORIES=	biology
MASTER_SITES=	${MASTER_SITE_GITHUB:=COMBINE-lab/} \
		https://github.com/COMBINE-lab/RapMap/archive/ \
		https://github.com/COMBINE-lab/libgff/archive/ \
		https://github.com/COMBINE-lab/staden-io_lib/archive/
DISTFILES=	salmon-0.11.3.tar.gz salmon-v0.11.3.zip v1.1.tar.gz v1.14.8.1.tar.gz
EXTRACT_ONLY=	salmon-0.11.3.tar.gz v1.14.8.1.tar.gz
#GITHUB_PROJECT=	salmon
#GITHUB_TAG=	v${PV}

MAINTAINER=	bacon@NetBSD.org
HOMEPAGE=	https://github.com/COMBINE-lab/salmon
COMMENT=	Transcript-level quantification of RNA-seq from lightweight alignments
LICENSE=	gnu-gpl-v3

SUBST_CLASSES+=		tbb
SUBST_STAGE.tbb=	post-patch
SUBST_SED.tbb+=		-e 's|tbbmalloc_proxy||g'
SUBST_FILES.tbb+=	${WRKSRC}/CMakeLists.txt

SUBST_CLASSES+=		staden
SUBST_STAGE.staden=	post-patch
SUBST_SED.staden+=	-e 's|&& make|&& gmake|g'
SUBST_FILES.staden+=	${WRKSRC}/CMakeFiles/libstadenio.dir/build.make

# Test and change if necessary.
# MAKE_JOBS_SAFE=	no

DEPENDS=	bash>=0:../../shells/bash \
		autoconf>=0:../../devel/autoconf

USE_LANGUAGES=	c c++
USE_TOOLS+=	cmake gmake
# FreeBSD's SHEBANG_FILES may include bash, perl, python, etc.
# I don't know which is which, so you'll have to finish.
# Add bash, etc. to USE_TOOLS if used below.
# 
REPLACE_BASH=	scripts/*.sh
REPLACE_PYTHON=	scripts/*.py
USE_CMAKE=	yes
CMAKE_ARGS+=	-DDISTDIR:PATH=${DISTDIR} \
		https://github.com/COMBINE-lab/libgff/archive/ \
		https://github.com/COMBINE-lab/staden-io_lib/archive/

CONFIGURE_ENV+=	DISTDIR=${DISTDIR} DIST_SUBDIR=salmon
#MAKE_ENV+=	WRKDIR=${WRKDIR} DISTDIR=${DISTDIR} DIST_SUBDIR=salmon
LDFLAGS+=	-lz

PV=		0.11.3
DATADIR=	${PREFIX}/share/salmon
DOCSDIR=	${PREFIX}/share/doc/salmon
EXAMPLESDIR=	${PREFIX}/share/examples/salmon

# Sets OPSYS, OS_VERSION, MACHINE_ARCH, etc..
# .include "../../mk/bsd.prefs.mk"

# Keep this if there are user-selectable options.
# .include "options.mk"

# Specify which directories to create before install.
# You should only need this if using your own install target.
INSTALLATION_DIRS=	bin include lib ${PKGMANDIR}/man1 share/doc share/examples

# Convert any _DEPENDS above that have a buildlink3.mk
.include "../../devel/libgetopt/buildlink3.mk"
.include "../../devel/zlib/buildlink3.mk"
.include "../../devel/boost-libs/buildlink3.mk"
.include "../../wip/cereal/buildlink3.mk"
.include "../../wip/tbb/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"

$NetBSD$

# Respect build env
--- Makefile.orig	2016-04-22 09:22:44.000000000 +0000
+++ Makefile
@@ -21,10 +21,10 @@
 # FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 # DEALINGS IN THE SOFTWARE.
 
-CC       = gcc
-CPPFLAGS =
-CFLAGS   = -g -Wall -O2
-LDFLAGS  =
+CC       ?= gcc
+CPPFLAGS ?=
+CFLAGS   ?= -g -Wall -O2
+LDFLAGS  ?=
 LIBS     =
 
 LOBJS=      bam_aux.o bam.o bam_import.o sam.o \
@@ -38,20 +38,13 @@ AOBJS=      bam_index.o bam_plcmd.o sam_
             bam_tview.o bam_tview_curses.o bam_tview_html.o bam_lpileup.o \
             bam_quickcheck.o bam_addrprg.o
 
-prefix      = /usr/local
+prefix      = $(STAGEDIR)$(PREFIX)
 exec_prefix = $(prefix)
 bindir      = $(exec_prefix)/bin
 datarootdir = $(prefix)/share
-mandir      = $(datarootdir)/man
+mandir      = $(PKGMANDIR)/man
 man1dir     = $(mandir)/man1
 
-MKDIR_P = mkdir -p
-INSTALL = install -p
-INSTALL_PROGRAM = $(INSTALL)
-INSTALL_DATA    = $(INSTALL) -m 644
-INSTALL_DIR     = $(MKDIR_P) -m 755
-
-
 PROGRAMS = samtools
 
 BUILT_MISC_PROGRAMS = \
@@ -59,7 +52,6 @@ BUILT_MISC_PROGRAMS = \
 	misc/md5fa misc/md5sum-lite misc/wgsim
 
 MISC_PROGRAMS = \
-	$(BUILT_MISC_PROGRAMS) \
 	misc/blast2sam.pl misc/bowtie2sam.pl misc/export2sam.pl \
 	misc/interpolate_sam.pl misc/novo2sam.pl \
 	misc/plot-bamstats misc/psl2sam.pl \
@@ -82,7 +74,7 @@ all: $(PROGRAMS) $(BUILT_MISC_PROGRAMS) 
 # TODO Use configure or htslib.pc to add -rdynamic/-ldl conditionally
 ALL_CPPFLAGS = -I. $(HTSLIB_CPPFLAGS) $(CPPFLAGS)
 ALL_LDFLAGS  = -rdynamic $(HTSLIB_LDFLAGS) $(LDFLAGS)
-ALL_LIBS     = -lz -ldl $(LIBS)
+ALL_LIBS     = -lz $(LIBS)
 
 # Usually config.mk and config.h are generated by running configure
 # or config.status, but if those aren't used create defaults here.
@@ -280,10 +272,12 @@ misc/maq2sam-long.o: misc/maq2sam.c conf
 
 
 install: $(PROGRAMS) $(BUILT_MISC_PROGRAMS)
-	$(INSTALL_DIR) $(DESTDIR)$(bindir) $(DESTDIR)$(man1dir)
-	$(INSTALL_PROGRAM) $(PROGRAMS) $(MISC_PROGRAMS) $(DESTDIR)$(bindir)
-	$(INSTALL_DATA) samtools.1 misc/wgsim.1 $(DESTDIR)$(man1dir)
-
+	$(BSD_INSTALL_PROGRAM_DIR) $(DESTDIR)$(bindir)
+	$(BSD_INSTALL_MAN_DIR) $(DESTDIR)$(man1dir) 
+	$(BSD_INSTALL_PROGRAM) $(PROGRAMS) $(DESTDIR)$(bindir)
+	$(BSD_INSTALL_PROGRAM) $(BUILT_MISC_PROGRAMS) $(DESTDIR)$(bindir)
+	$(BSD_INSTALL_SCRIPT) $(MISC_PROGRAMS) $(DESTDIR)$(bindir)
+	$(BSD_INSTALL_DATA) samtools.1 misc/wgsim.1 $(DESTDIR)$(man1dir)
 
 testclean:
 	-rm -f test/*.new test/*.tmp test/*/*.new test/*/*.tmp test/*/*.tmp.*
